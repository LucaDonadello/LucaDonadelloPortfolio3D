import{r as f,j as V}from"./react-Bt9ihhZL.js";import{L as Re,T as $e,R as Ut,U as qt,a as Vt,O as qe,P as Ve,S as rt,b as Oe,N as Xt,A as Yt,B as Zt,M as Kt,C as Jt,V as q,c as vt,W as Qt,d as er,e as tr,f as rr,g as nr,h as or,i as ir,D as sr,j as _e,k as Xe,l as ar,m as lr,E as ht,n as cr,o as ur,p as fr,q as ue,r as dr,s as pr,t as mr}from"./three-9VQCBSAt.js";import{u as vr}from"./react-use-measure-DkETLY2T.js";import{F as hr,u as gr}from"./its-fine-BG5bC5e_.js";import{R as yr,c as ce}from"./react-reconciler-NJZye9Cd.js";import{_ as J}from"./@babel-CCbyfPlC.js";import{c as br}from"./react-dom-DnqeeRme.js";import{c as gt}from"./zustand-Cgi5Jkvz.js";import"./maath-DgbsPAIX.js";import{D as wr,G as Ye,a as _r,M as je,O as Er}from"./three-stdlib-DDsljaIZ.js";import{s as Pr,p as Mr,c as xr}from"./suspend-react-BKIKQNXN.js";function En(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Pn(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var l=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,l.get?l:{enumerable:!0,get:function(){return e[i]}})}),r}var yt={exports:{}},bt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(b,C){var P=b.length;b.push(C);e:for(;0<P;){var S=P-1>>>1,A=b[S];if(0<l(A,C))b[S]=C,b[P]=A,P=S;else break e}}function r(b){return b.length===0?null:b[0]}function i(b){if(b.length===0)return null;var C=b[0],P=b.pop();if(P!==C){b[0]=P;e:for(var S=0,A=b.length,j=A>>>1;S<j;){var B=2*(S+1)-1,N=b[B],Y=B+1,oe=b[Y];if(0>l(N,P))Y<A&&0>l(oe,N)?(b[S]=oe,b[Y]=P,S=Y):(b[S]=N,b[B]=P,S=B);else if(Y<A&&0>l(oe,P))b[S]=oe,b[Y]=P,S=Y;else break e}}return C}function l(b,C){var P=b.sortIndex-C.sortIndex;return P!==0?P:b.id-C.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var g=Date,h=g.now();e.unstable_now=function(){return g.now()-h}}var c=[],y=[],n=1,o=null,s=3,p=!1,m=!1,E=!1,v=typeof setTimeout=="function"?setTimeout:null,u=typeof clearTimeout=="function"?clearTimeout:null,d=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function M(b){for(var C=r(y);C!==null;){if(C.callback===null)i(y);else if(C.startTime<=b)i(y),C.sortIndex=C.expirationTime,t(c,C);else break;C=r(y)}}function O(b){if(E=!1,M(b),!m)if(r(c)!==null)m=!0,$(x);else{var C=r(y);C!==null&&H(O,C.startTime-b)}}function x(b,C){m=!1,E&&(E=!1,u(k),k=-1),p=!0;var P=s;try{for(M(C),o=r(c);o!==null&&(!(o.expirationTime>C)||b&&!w());){var S=o.callback;if(typeof S=="function"){o.callback=null,s=o.priorityLevel;var A=S(o.expirationTime<=C);C=e.unstable_now(),typeof A=="function"?o.callback=A:o===r(c)&&i(c),M(C)}else i(c);o=r(c)}if(o!==null)var j=!0;else{var B=r(y);B!==null&&H(O,B.startTime-C),j=!1}return j}finally{o=null,s=P,p=!1}}var _=!1,T=null,k=-1,R=5,L=-1;function w(){return!(e.unstable_now()-L<R)}function D(){if(T!==null){var b=e.unstable_now();L=b;var C=!0;try{C=T(!0,b)}finally{C?W():(_=!1,T=null)}}else _=!1}var W;if(typeof d=="function")W=function(){d(D)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,z=X.port2;X.port1.onmessage=D,W=function(){z.postMessage(null)}}else W=function(){v(D,0)};function $(b){T=b,_||(_=!0,W())}function H(b,C){k=v(function(){b(e.unstable_now())},C)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(b){b.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,$(x))},e.unstable_forceFrameRate=function(b){0>b||125<b?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<b?Math.floor(1e3/b):5},e.unstable_getCurrentPriorityLevel=function(){return s},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(b){switch(s){case 1:case 2:case 3:var C=3;break;default:C=s}var P=s;s=C;try{return b()}finally{s=P}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(b,C){switch(b){case 1:case 2:case 3:case 4:case 5:break;default:b=3}var P=s;s=b;try{return C()}finally{s=P}},e.unstable_scheduleCallback=function(b,C,P){var S=e.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?S+P:S):P=S,b){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=P+A,b={id:n++,callback:C,priorityLevel:b,startTime:P,expirationTime:A,sortIndex:-1},P>S?(b.sortIndex=P,t(y,b),r(c)===null&&b===r(y)&&(E?(u(k),k=-1):E=!0,H(O,P-S))):(b.sortIndex=A,t(c,b),m||p||(m=!0,$(x))),b},e.unstable_shouldYield=w,e.unstable_wrapCallback=function(b){var C=s;return function(){var P=s;s=C;try{return b.apply(this,arguments)}finally{s=P}}}})(bt);yt.exports=bt;var nt=yt.exports;const Ze={},Cr=e=>void Object.assign(Ze,e);function Sr(e,t){function r(n,{args:o=[],attach:s,...p},m){let E=`${n[0].toUpperCase()}${n.slice(1)}`,v;if(n==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const u=p.object;v=ae(u,{type:n,root:m,attach:s,primitive:!0})}else{const u=Ze[E];if(!u)throw new Error(`R3F: ${E} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");v=ae(new u(...o),{type:n,root:m,attach:s,memoizedProps:{args:o}})}return v.__r3f.attach===void 0&&(v instanceof Zt?v.__r3f.attach="geometry":v instanceof Kt&&(v.__r3f.attach="material")),E!=="inject"&&ke(v,p),v}function i(n,o){let s=!1;if(o){var p,m;(p=o.__r3f)!=null&&p.attach?Ae(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),s=!0),s||(m=n.__r3f)==null||m.objects.push(o),o.__r3f||ae(o,{}),o.__r3f.parent=n,Ge(o),le(o)}}function l(n,o,s){let p=!1;if(o){var m,E;if((m=o.__r3f)!=null&&m.attach)Ae(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"}),n.dispatchEvent({type:"childadded",child:o});const v=n.children.filter(d=>d!==o),u=v.indexOf(s);n.children=[...v.slice(0,u),o,...v.slice(u)],p=!0}p||(E=n.__r3f)==null||E.objects.push(o),o.__r3f||ae(o,{}),o.__r3f.parent=n,Ge(o),le(o)}}function a(n,o,s=!1){n&&[...n].forEach(p=>g(o,p,s))}function g(n,o,s){if(o){var p,m,E;if(o.__r3f&&(o.__r3f.parent=null),(p=n.__r3f)!=null&&p.objects&&(n.__r3f.objects=n.__r3f.objects.filter(O=>O!==o)),(m=o.__r3f)!=null&&m.attach)lt(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var v;n.remove(o),(v=o.__r3f)!=null&&v.root&&Fr(xe(o),o)}const d=(E=o.__r3f)==null?void 0:E.primitive,M=!d&&(s===void 0?o.dispose!==null:s);if(!d){var u;a((u=o.__r3f)==null?void 0:u.objects,o,M),a(o.children,o,M)}if(delete o.__r3f,M&&o.dispose&&o.type!=="Scene"){const O=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?nt.unstable_scheduleCallback(nt.unstable_IdlePriority,O):O()}le(n)}}function h(n,o,s,p){var m;const E=(m=n.__r3f)==null?void 0:m.parent;if(!E)return;const v=r(o,s,n.__r3f.root);if(n.children){for(const u of n.children)u.__r3f&&i(v,u);n.children=n.children.filter(u=>!u.__r3f)}n.__r3f.objects.forEach(u=>i(v,u)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||g(E,n),v.parent&&(v.__r3f.autoRemovedBeforeAppend=!0),i(E,v),v.raycast&&v.__r3f.eventCount&&xe(v).getState().internal.interaction.push(v),[p,p.alternate].forEach(u=>{u!==null&&(u.stateNode=v,u.ref&&(typeof u.ref=="function"?u.ref(v):u.ref.current=v))})}const c=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:yr({createInstance:r,removeChild:g,appendChild:i,appendInitialChild:i,insertBefore:l,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const s=n.getState().scene;s.__r3f&&(s.__r3f.root=n,i(s,o))},removeChildFromContainer:(n,o)=>{o&&g(n.getState().scene,o)},insertInContainerBefore:(n,o,s)=>{if(!o||!s)return;const p=n.getState().scene;p.__r3f&&l(p,o,s)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,s,p){var m;if(((m=n==null?void 0:n.__r3f)!=null?m:{}).primitive&&p.object&&p.object!==n)return[!0];{const{args:v=[],children:u,...d}=p,{args:M=[],children:O,...x}=s;if(!Array.isArray(v))throw new Error("R3F: the args prop must be an array!");if(v.some((T,k)=>T!==M[k]))return[!0];const _=Ct(n,d,x,!0);return _.changes.length?[!1,_]:null}},commitUpdate(n,[o,s],p,m,E,v){o?h(n,p,E,v):ke(n,s)},commitMount(n,o,s,p){var m;const E=(m=n.__r3f)!=null?m:{};n.raycast&&E.handlers&&E.eventCount&&xe(n).getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>ae(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:s,parent:p}=(o=n.__r3f)!=null?o:{};s&&p&&lt(p,n,s),n.isObject3D&&(n.visible=!1),le(n)},unhideInstance(n,o){var s;const{attach:p,parent:m}=(s=n.__r3f)!=null?s:{};p&&m&&Ae(m,n,p),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),le(n)},createTextInstance:c,hideTextInstance:c,unhideTextInstance:c,getCurrentEventPriority:()=>t?t():ce.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ke}}var ot,it;const Te=e=>"colorSpace"in e||"outputColorSpace"in e,wt=()=>{var e;return(e=Ze.ColorManagement)!=null?e:null},_t=e=>e&&e.isOrthographicCamera,Rr=e=>e&&e.hasOwnProperty("current"),ge=typeof window<"u"&&((ot=window.document)!=null&&ot.createElement||((it=window.navigator)==null?void 0:it.product)==="ReactNative")?f.useLayoutEffect:f.useEffect;function Et(e){const t=f.useRef(e);return ge(()=>void(t.current=e),[e]),t}function Or({set:e}){return ge(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Pt extends f.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Pt.getDerivedStateFromError=()=>({error:!0});const Mt="__default",st=new Map,jr=e=>e&&!!e.memoized&&!!e.changes;function xt(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const pe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function xe(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:l=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e))return e===t;const a=I.obj(e);if(a&&i==="reference")return e===t;const g=I.arr(e);if(g&&r==="reference")return e===t;if((g||a)&&e===t)return!0;let h;for(h in e)if(!(h in t))return!1;if(a&&r==="shallow"&&i==="shallow"){for(h in l?t:e)if(!I.equ(e[h],t[h],{strict:l,objects:"reference"}))return!1}else for(h in l?t:e)if(e[h]!==t[h])return!1;if(I.und(h)){if(g&&e.length===0&&t.length===0||a&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Tr(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function Ar(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ae(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Ne(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),l=i.pop();return r=i.reduce((a,g)=>a[g],e),{target:r,key:l}}else return{target:r,key:t}}const at=/-\d+$/;function Ae(e,t,r){if(I.str(r)){if(at.test(r)){const a=r.replace(at,""),{target:g,key:h}=Ne(e,a);Array.isArray(g[h])||(g[h]=[])}const{target:i,key:l}=Ne(e,r);t.__r3f.previousAttach=i[l],i[l]=t}else t.__r3f.previousAttach=r(e,t)}function lt(e,t,r){var i,l;if(I.str(r)){const{target:a,key:g}=Ne(e,r),h=t.__r3f.previousAttach;h===void 0?delete a[g]:a[g]=h}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(l=t.__r3f)==null||delete l.previousAttach}function Ct(e,{children:t,key:r,ref:i,...l},{children:a,key:g,ref:h,...c}={},y=!1){const n=e.__r3f,o=Object.entries(l),s=[];if(y){const m=Object.keys(c);for(let E=0;E<m.length;E++)l.hasOwnProperty(m[E])||o.unshift([m[E],Mt+"remove"])}o.forEach(([m,E])=>{var v;if((v=e.__r3f)!=null&&v.primitive&&m==="object"||I.equ(E,c[m]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(m))return s.push([m,E,!0,[]]);let u=[];m.includes("-")&&(u=m.split("-")),s.push([m,E,!1,u]);for(const d in l){const M=l[d];d.startsWith(`${m}-`)&&s.push([d,M,!1,d.split("-")])}});const p={...l};return n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.args&&(p.args=n.memoizedProps.args),n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.attach&&(p.attach=n.memoizedProps.attach),{memoized:p,changes:s}}const kr=typeof process<"u"&&!1;function ke(e,t){var r;const i=e.__r3f,l=i==null?void 0:i.root,a=l==null||l.getState==null?void 0:l.getState(),{memoized:g,changes:h}=jr(t)?t:Ct(e,t),c=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=g);for(let n=0;n<h.length;n++){let[o,s,p,m]=h[n];if(Te(e)){const d="srgb",M="srgb-linear";o==="encoding"?(o="colorSpace",s=s===3001?d:M):o==="outputEncoding"&&(o="outputColorSpace",s=s===3001?d:M)}let E=e,v=E[o];if(m.length&&(v=m.reduce((u,d)=>u[d],e),!(v&&v.set))){const[u,...d]=m.reverse();E=d.reverse().reduce((M,O)=>M[O],e),o=u}if(s===Mt+"remove")if(E.constructor){let u=st.get(E.constructor);u||(u=new E.constructor,st.set(E.constructor,u)),s=u[o]}else s=0;if(p&&i)s?i.handlers[o]=s:delete i.handlers[o],i.eventCount=Object.keys(i.handlers).length;else if(v&&v.set&&(v.copy||v instanceof Re)){if(Array.isArray(s))v.fromArray?v.fromArray(s):v.set(...s);else if(v.copy&&s&&s.constructor&&(kr?v.constructor.name===s.constructor.name:v.constructor===s.constructor))v.copy(s);else if(s!==void 0){const u=v instanceof Jt;!u&&v.setScalar?v.setScalar(s):v instanceof Re&&s instanceof Re?v.mask=s.mask:v.set(s),!wt()&&a&&!a.linear&&u&&v.convertSRGBToLinear()}}else if(E[o]=s,E[o]instanceof $e&&E[o].format===Ut&&E[o].type===qt&&a){const u=E[o];Te(u)&&Te(a.gl)?u.colorSpace=a.gl.outputColorSpace:u.encoding=a.gl.outputEncoding}le(e)}if(i&&i.parent&&e.raycast&&c!==i.eventCount){const n=xe(e).getState().internal,o=n.interaction.indexOf(e);o>-1&&n.interaction.splice(o,1),i.eventCount&&n.interaction.push(e)}return!(h.length===1&&h[0][0]==="onUpdate")&&h.length&&(r=e.__r3f)!=null&&r.parent&&Ge(e),e}function le(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function Ge(e){e.onUpdate==null||e.onUpdate(e)}function Dr(e,t){e.manual||(_t(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function Ee(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Lr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ce.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ce.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ce.ContinuousEventPriority;default:return ce.DefaultEventPriority}}function St(e,t,r,i){const l=r.get(t);l&&(r.delete(t),r.size===0&&(e.delete(i),l.target.releasePointerCapture(i)))}function Fr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,l)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(l)}),r.capturedMap.forEach((i,l)=>{St(r.capturedMap,t,i,l)})}function Ir(e){function t(c){const{internal:y}=e.getState(),n=c.offsetX-y.initialClick[0],o=c.offsetY-y.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(c){return c.filter(y=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=y.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(c,y){const n=e.getState(),o=new Set,s=[],p=y?y(n.internal.interaction):n.internal.interaction;for(let u=0;u<p.length;u++){const d=pe(p[u]);d&&(d.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(c,n);function m(u){const d=pe(u);if(!d||!d.events.enabled||d.raycaster.camera===null)return[];if(d.raycaster.camera===void 0){var M;d.events.compute==null||d.events.compute(c,d,(M=d.previousRoot)==null?void 0:M.getState()),d.raycaster.camera===void 0&&(d.raycaster.camera=null)}return d.raycaster.camera?d.raycaster.intersectObject(u,!0):[]}let E=p.flatMap(m).sort((u,d)=>{const M=pe(u.object),O=pe(d.object);return!M||!O?u.distance-d.distance:O.events.priority-M.events.priority||u.distance-d.distance}).filter(u=>{const d=Ee(u);return o.has(d)?!1:(o.add(d),!0)});n.events.filter&&(E=n.events.filter(E,n));for(const u of E){let d=u.object;for(;d;){var v;(v=d.__r3f)!=null&&v.eventCount&&s.push({...u,eventObject:d}),d=d.parent}}if("pointerId"in c&&n.internal.capturedMap.has(c.pointerId))for(let u of n.internal.capturedMap.get(c.pointerId).values())o.has(Ee(u.intersection))||s.push(u.intersection);return s}function l(c,y,n,o){const s=e.getState();if(c.length){const p={stopped:!1};for(const m of c){const E=pe(m.object)||s,{raycaster:v,pointer:u,camera:d,internal:M}=E,O=new q(u.x,u.y,0).unproject(d),x=L=>{var w,D;return(w=(D=M.capturedMap.get(L))==null?void 0:D.has(m.eventObject))!=null?w:!1},_=L=>{const w={intersection:m,target:y.target};M.capturedMap.has(L)?M.capturedMap.get(L).set(m.eventObject,w):M.capturedMap.set(L,new Map([[m.eventObject,w]])),y.target.setPointerCapture(L)},T=L=>{const w=M.capturedMap.get(L);w&&St(M.capturedMap,m.eventObject,w,L)};let k={};for(let L in y){let w=y[L];typeof w!="function"&&(k[L]=w)}let R={...m,...k,pointer:u,intersections:c,stopped:p.stopped,delta:n,unprojectedPoint:O,ray:v.ray,camera:d,stopPropagation(){const L="pointerId"in y&&M.capturedMap.get(y.pointerId);if((!L||L.has(m.eventObject))&&(R.stopped=p.stopped=!0,M.hovered.size&&Array.from(M.hovered.values()).find(w=>w.eventObject===m.eventObject))){const w=c.slice(0,c.indexOf(m));a([...w,m])}},target:{hasPointerCapture:x,setPointerCapture:_,releasePointerCapture:T},currentTarget:{hasPointerCapture:x,setPointerCapture:_,releasePointerCapture:T},nativeEvent:y};if(o(R),p.stopped===!0)break}}return c}function a(c){const{internal:y}=e.getState();for(const n of y.hovered.values())if(!c.length||!c.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const s=n.eventObject.__r3f,p=s==null?void 0:s.handlers;if(y.hovered.delete(Ee(n)),s!=null&&s.eventCount){const m={...n,intersections:c};p.onPointerOut==null||p.onPointerOut(m),p.onPointerLeave==null||p.onPointerLeave(m)}}}function g(c,y){for(let n=0;n<y.length;n++){const o=y[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(c)}}function h(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>a([]);case"onLostPointerCapture":return y=>{const{internal:n}=e.getState();"pointerId"in y&&n.capturedMap.has(y.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(y.pointerId)&&(n.capturedMap.delete(y.pointerId),a([]))})}}return function(n){const{onPointerMissed:o,internal:s}=e.getState();s.lastEvent.current=n;const p=c==="onPointerMove",m=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",v=i(n,p?r:void 0),u=m?t(n):0;c==="onPointerDown"&&(s.initialClick=[n.offsetX,n.offsetY],s.initialHits=v.map(M=>M.eventObject)),m&&!v.length&&u<=2&&(g(n,s.interaction),o&&o(n)),p&&a(v);function d(M){const O=M.eventObject,x=O.__r3f,_=x==null?void 0:x.handlers;if(x!=null&&x.eventCount)if(p){if(_.onPointerOver||_.onPointerEnter||_.onPointerOut||_.onPointerLeave){const T=Ee(M),k=s.hovered.get(T);k?k.stopped&&M.stopPropagation():(s.hovered.set(T,M),_.onPointerOver==null||_.onPointerOver(M),_.onPointerEnter==null||_.onPointerEnter(M))}_.onPointerMove==null||_.onPointerMove(M)}else{const T=_[c];T?(!m||s.initialHits.includes(O))&&(g(n,s.interaction.filter(k=>!s.initialHits.includes(k))),T(M)):m&&s.initialHits.includes(O)&&g(n,s.interaction.filter(k=>!s.initialHits.includes(k)))}}l(v,n,u,d)}}return{handlePointer:h}}const Rt=e=>!!(e!=null&&e.render),Ot=f.createContext(null),zr=(e,t)=>{const r=gt((h,c)=>{const y=new q,n=new q,o=new q;function s(u=c().camera,d=n,M=c().size){const{width:O,height:x,top:_,left:T}=M,k=O/x;d instanceof q?o.copy(d):o.set(...d);const R=u.getWorldPosition(y).distanceTo(o);if(_t(u))return{width:O/u.zoom,height:x/u.zoom,top:_,left:T,factor:1,distance:R,aspect:k};{const L=u.fov*Math.PI/180,w=2*Math.tan(L/2)*R,D=w*(O/x);return{width:D,height:w,top:_,left:T,factor:O/D,distance:R,aspect:k}}}let p;const m=u=>h(d=>({performance:{...d.performance,current:u}})),E=new vt;return{set:h,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(u=1)=>e(c(),u),advance:(u,d)=>t(u,d,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new or,pointer:E,mouse:E,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const u=c();p&&clearTimeout(p),u.performance.current!==u.performance.min&&m(u.performance.min),p=setTimeout(()=>m(c().performance.max),u.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:s},setEvents:u=>h(d=>({...d,events:{...d.events,...u}})),setSize:(u,d,M,O,x)=>{const _=c().camera,T={width:u,height:d,top:O||0,left:x||0,updateStyle:M};h(k=>({size:T,viewport:{...k.viewport,...s(_,n,T)}}))},setDpr:u=>h(d=>{const M=xt(u);return{viewport:{...d.viewport,dpr:M,initialDpr:d.viewport.initialDpr||M}}}),setFrameloop:(u="always")=>{const d=c().clock;d.stop(),d.elapsedTime=0,u!=="never"&&(d.start(),d.elapsedTime=0),h(()=>({frameloop:u}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:f.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(u,d,M)=>{const O=c().internal;return O.priority=O.priority+(d>0?1:0),O.subscribers.push({ref:u,priority:d,store:M}),O.subscribers=O.subscribers.sort((x,_)=>x.priority-_.priority),()=>{const x=c().internal;x!=null&&x.subscribers&&(x.priority=x.priority-(d>0?1:0),x.subscribers=x.subscribers.filter(_=>_.ref!==u))}}}}}),i=r.getState();let l=i.size,a=i.viewport.dpr,g=i.camera;return r.subscribe(()=>{const{camera:h,size:c,viewport:y,gl:n,set:o}=r.getState();if(c.width!==l.width||c.height!==l.height||y.dpr!==a){var s;l=c,a=y.dpr,Dr(h,c),n.setPixelRatio(y.dpr);const p=(s=c.updateStyle)!=null?s:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(c.width,c.height,p)}h!==g&&(g=h,o(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(h)}})))}),r.subscribe(h=>e(h)),r};let Pe,Hr=new Set,Wr=new Set,Br=new Set;function De(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function me(e,t){switch(e){case"before":return De(Hr,t);case"after":return De(Wr,t);case"tail":return De(Br,t)}}let Le,Fe;function Ie(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Le=t.internal.subscribers,Pe=0;Pe<Le.length;Pe++)Fe=Le[Pe],Fe.ref.current(Fe.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function $r(e){let t=!1,r=!1,i,l,a;function g(y){l=requestAnimationFrame(g),t=!0,i=0,me("before",y),r=!0;for(const o of e.values()){var n;a=o.store.getState(),a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&!((n=a.gl.xr)!=null&&n.isPresenting)&&(i+=Ie(y,a))}if(r=!1,me("after",y),i===0)return me("tail",y),t=!1,cancelAnimationFrame(l)}function h(y,n=1){var o;if(!y)return e.forEach(s=>h(s.store.getState(),n));(o=y.gl.xr)!=null&&o.isPresenting||!y.internal.active||y.frameloop==="never"||(n>1?y.internal.frames=Math.min(60,y.internal.frames+n):r?y.internal.frames=2:y.internal.frames=1,t||(t=!0,requestAnimationFrame(g)))}function c(y,n=!0,o,s){if(n&&me("before",y),o)Ie(y,o,s);else for(const p of e.values())Ie(y,p.store.getState());n&&me("after",y)}return{loop:g,invalidate:h,advance:c}}function jt(){const e=f.useContext(Ot);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function U(e=r=>r,t){return jt()(e,t)}function ye(e,t=0){const r=jt(),i=r.getState().internal.subscribe,l=Et(e);return ge(()=>i(l,t,r),[t,i,r]),null}const ct=new WeakMap;function Tt(e,t){return function(r,...i){let l=ct.get(r);return l||(l=new r,ct.set(r,l)),e&&e(l),Promise.all(i.map(a=>new Promise((g,h)=>l.load(a,c=>{c.scene&&Object.assign(c,Tr(c.scene)),g(c)},t,c=>h(new Error(`Could not load ${a}: ${c==null?void 0:c.message}`))))))}}function Q(e,t,r,i){const l=Array.isArray(t)?t:[t],a=Pr(Tt(r,i),[e,...l],{equal:I.equ});return Array.isArray(t)?a:a[0]}Q.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return Mr(Tt(r),[e,...i])};Q.clear=function(e,t){const r=Array.isArray(t)?t:[t];return xr([e,...r])};const fe=new Map,{invalidate:ut,advance:ft}=$r(fe),{reconciler:Ce,applyProps:Z}=Sr(fe,Lr),se={objects:"shallow",strict:!1},Nr=(e,t)=>{const r=typeof e=="function"?e(t):e;return Rt(r)?r:new Qt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Gr(e,t){const r=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:l,top:a,left:g,updateStyle:h=r}=t;return{width:i,height:l,top:a,left:g,updateStyle:h}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:l,top:a,left:g}=e.parentElement.getBoundingClientRect();return{width:i,height:l,top:a,left:g,updateStyle:r}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:r};return{width:0,height:0,top:0,left:0}}function Ur(e){const t=fe.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const l=typeof reportError=="function"?reportError:console.error,a=i||zr(ut,ft),g=r||Ce.createContainer(a,ce.ConcurrentRoot,null,!1,null,"",l,null);t||fe.set(e,{fiber:g,store:a});let h,c=!1,y;return{configure(n={}){let{gl:o,size:s,scene:p,events:m,onCreated:E,shadows:v=!1,linear:u=!1,flat:d=!1,legacy:M=!1,orthographic:O=!1,frameloop:x="always",dpr:_=[1,2],performance:T,raycaster:k,camera:R,onPointerMissed:L}=n,w=a.getState(),D=w.gl;w.gl||w.set({gl:D=Nr(o,e)});let W=w.raycaster;W||w.set({raycaster:W=new Vt});const{params:X,...z}=k||{};if(I.equ(z,W,se)||Z(W,{...z}),I.equ(X,W.params,se)||Z(W,{params:{...W.params,...X}}),!w.camera||w.camera===y&&!I.equ(y,R,se)){y=R;const P=R instanceof er,S=P?R:O?new qe(0,0,0,0,.1,1e3):new Ve(75,0,.1,1e3);P||(S.position.z=5,R&&(Z(S,R),("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(S.manual=!0,S.updateProjectionMatrix())),!w.camera&&!(R!=null&&R.rotation)&&S.lookAt(0,0,0)),w.set({camera:S}),W.camera=S}if(!w.scene){let P;p instanceof rt?P=p:(P=new rt,p&&Z(P,p)),w.set({scene:ae(P)})}if(!w.xr){var $;const P=(j,B)=>{const N=a.getState();N.frameloop!=="never"&&ft(j,!0,N,B)},S=()=>{const j=a.getState();j.gl.xr.enabled=j.gl.xr.isPresenting,j.gl.xr.setAnimationLoop(j.gl.xr.isPresenting?P:null),j.gl.xr.isPresenting||ut(j)},A={connect(){const j=a.getState().gl;j.xr.addEventListener("sessionstart",S),j.xr.addEventListener("sessionend",S)},disconnect(){const j=a.getState().gl;j.xr.removeEventListener("sessionstart",S),j.xr.removeEventListener("sessionend",S)}};typeof(($=D.xr)==null?void 0:$.addEventListener)=="function"&&A.connect(),w.set({xr:A})}if(D.shadowMap){const P=D.shadowMap.enabled,S=D.shadowMap.type;if(D.shadowMap.enabled=!!v,I.boo(v))D.shadowMap.type=Oe;else if(I.str(v)){var H;const A={basic:tr,percentage:rr,soft:Oe,variance:nr};D.shadowMap.type=(H=A[v])!=null?H:Oe}else I.obj(v)&&Object.assign(D.shadowMap,v);(P!==D.shadowMap.enabled||S!==D.shadowMap.type)&&(D.shadowMap.needsUpdate=!0)}const b=wt();b&&("enabled"in b?b.enabled=!M:"legacyMode"in b&&(b.legacyMode=M)),c||Z(D,{outputEncoding:u?3e3:3001,toneMapping:d?Xt:Yt}),w.legacy!==M&&w.set(()=>({legacy:M})),w.linear!==u&&w.set(()=>({linear:u})),w.flat!==d&&w.set(()=>({flat:d})),o&&!I.fun(o)&&!Rt(o)&&!I.equ(o,D,se)&&Z(D,o),m&&!w.events.handlers&&w.set({events:m(a)});const C=Gr(e,s);return I.equ(C,w.size,se)||w.setSize(C.width,C.height,C.updateStyle,C.top,C.left),_&&w.viewport.dpr!==xt(_)&&w.setDpr(_),w.frameloop!==x&&w.setFrameloop(x),w.onPointerMissed||w.set({onPointerMissed:L}),T&&!I.equ(T,w.performance,se)&&w.set(P=>({performance:{...P.performance,...T}})),h=E,c=!0,this},render(n){return c||this.configure(),Ce.updateContainer(V.jsx(qr,{store:a,children:n,onCreated:h,rootElement:e}),g,null,()=>{}),a},unmount(){At(e)}}}function qr({store:e,children:t,onCreated:r,rootElement:i}){return ge(()=>{const l=e.getState();l.set(a=>({internal:{...a.internal,active:!0}})),r&&r(l),e.getState().events.connected||l.events.connect==null||l.events.connect(i)},[]),V.jsx(Ot.Provider,{value:e,children:t})}function At(e,t){const r=fe.get(e),i=r==null?void 0:r.fiber;if(i){const l=r==null?void 0:r.store.getState();l&&(l.internal.active=!1),Ce.updateContainer(null,i,null,()=>{l&&setTimeout(()=>{try{var a,g,h,c;l.events.disconnect==null||l.events.disconnect(),(a=l.gl)==null||(g=a.renderLists)==null||g.dispose==null||g.dispose(),(h=l.gl)==null||h.forceContextLoss==null||h.forceContextLoss(),(c=l.gl)!=null&&c.xr&&l.xr.disconnect(),Ar(l),fe.delete(e)}catch{}},500)})}}Ce.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:f.version});const ze={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Vr(e){const{handlePointer:t}=Ir(e);return{priority:1,enabled:!0,compute(r,i,l){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ze).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:l}=e.getState();(r=l.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(l.lastEvent.current)},connect:r=>{var i;const{set:l,events:a}=e.getState();a.disconnect==null||a.disconnect(),l(g=>({events:{...g.events,connected:r}})),Object.entries((i=a.handlers)!=null?i:[]).forEach(([g,h])=>{const[c,y]=ze[g];r.addEventListener(c,h,{passive:y})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var l;Object.entries((l=i.handlers)!=null?l:[]).forEach(([a,g])=>{if(i&&i.connected instanceof HTMLElement){const[h]=ze[a];i.connected.removeEventListener(h,g)}}),r(a=>({events:{...a.events,connected:void 0}}))}}}}const Xr=f.forwardRef(function({children:t,fallback:r,resize:i,style:l,gl:a,events:g=Vr,eventSource:h,eventPrefix:c,shadows:y,linear:n,flat:o,legacy:s,orthographic:p,frameloop:m,dpr:E,performance:v,raycaster:u,camera:d,scene:M,onPointerMissed:O,onCreated:x,..._},T){f.useMemo(()=>Cr(ir),[]);const k=gr(),[R,L]=vr({scroll:!0,debounce:{scroll:50,resize:0},...i}),w=f.useRef(null),D=f.useRef(null);f.useImperativeHandle(T,()=>w.current);const W=Et(O),[X,z]=f.useState(!1),[$,H]=f.useState(!1);if(X)throw X;if($)throw $;const b=f.useRef(null);ge(()=>{const P=w.current;L.width>0&&L.height>0&&P&&(b.current||(b.current=Ur(P)),b.current.configure({gl:a,events:g,shadows:y,linear:n,flat:o,legacy:s,orthographic:p,frameloop:m,dpr:E,performance:v,raycaster:u,camera:d,scene:M,size:L,onPointerMissed:(...S)=>W.current==null?void 0:W.current(...S),onCreated:S=>{S.events.connect==null||S.events.connect(h?Rr(h)?h.current:h:D.current),c&&S.setEvents({compute:(A,j)=>{const B=A[c+"X"],N=A[c+"Y"];j.pointer.set(B/j.size.width*2-1,-(N/j.size.height)*2+1),j.raycaster.setFromCamera(j.pointer,j.camera)}}),x==null||x(S)}}),b.current.render(V.jsx(k,{children:V.jsx(Pt,{set:H,children:V.jsx(f.Suspense,{fallback:V.jsx(Or,{set:z}),children:t})})})))}),f.useEffect(()=>{const P=w.current;if(P)return()=>At(P)},[]);const C=h?"none":"auto";return V.jsx("div",{ref:D,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:C,...l},..._,children:V.jsx("div",{ref:R,style:{width:"100%",height:"100%"},children:V.jsx("canvas",{ref:w,style:{display:"block"},children:r})})})}),Mn=f.forwardRef(function(t,r){return V.jsx(hr,{children:V.jsx(Xr,{...t,ref:r})})}),be=new q,Ke=new q,Yr=new q,dt=new vt;function Zr(e,t,r){const i=be.setFromMatrixPosition(e.matrixWorld);i.project(t);const l=r.width/2,a=r.height/2;return[i.x*l+l,-(i.y*a)+a]}function Kr(e,t){const r=be.setFromMatrixPosition(e.matrixWorld),i=Ke.setFromMatrixPosition(t.matrixWorld),l=r.sub(i),a=t.getWorldDirection(Yr);return l.angleTo(a)>Math.PI/2}function Jr(e,t,r,i){const l=be.setFromMatrixPosition(e.matrixWorld),a=l.clone();a.project(t),dt.set(a.x,a.y),r.setFromCamera(dt,t);const g=r.intersectObjects(i,!0);if(g.length){const h=g[0].distance;return l.distanceTo(r.ray.origin)<h}return!0}function Qr(e,t){if(t instanceof qe)return t.zoom;if(t instanceof Ve){const r=be.setFromMatrixPosition(e.matrixWorld),i=Ke.setFromMatrixPosition(t.matrixWorld),l=t.fov*Math.PI/180,a=r.distanceTo(i);return 1/(2*Math.tan(l/2)*a)}else return 1}function en(e,t,r){if(t instanceof Ve||t instanceof qe){const i=be.setFromMatrixPosition(e.matrixWorld),l=Ke.setFromMatrixPosition(t.matrixWorld),a=i.distanceTo(l),g=(r[1]-r[0])/(t.far-t.near),h=r[1]-g*t.far;return Math.round(g*a+h)}}const Ue=e=>Math.abs(e)<1e-10?0:e;function kt(e,t,r=""){let i="matrix3d(";for(let l=0;l!==16;l++)i+=Ue(t[l]*e.elements[l])+(l!==15?",":")");return r+i}const tn=(e=>t=>kt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),rn=(e=>(t,r)=>kt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function nn(e){return e&&typeof e=="object"&&"current"in e}const xn=f.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:l,center:a,fullscreen:g,portal:h,distanceFactor:c,sprite:y=!1,transform:n=!1,occlude:o,onOcclude:s,castShadow:p,receiveShadow:m,material:E,geometry:v,zIndexRange:u=[16777271,0],calculatePosition:d=Zr,as:M="div",wrapperClass:O,pointerEvents:x="auto",..._},T)=>{const{gl:k,camera:R,scene:L,size:w,raycaster:D,events:W,viewport:X}=U(),[z]=f.useState(()=>document.createElement(M)),$=f.useRef(),H=f.useRef(null),b=f.useRef(0),C=f.useRef([0,0]),P=f.useRef(null),S=f.useRef(null),A=(h==null?void 0:h.current)||W.connected||k.domElement.parentNode,j=f.useRef(null),B=f.useRef(!1),N=f.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&nn(o[0]),[o]);f.useLayoutEffect(()=>{const G=k.domElement;o&&o==="blending"?(G.style.zIndex=`${Math.floor(u[0]/2)}`,G.style.position="absolute",G.style.pointerEvents="none"):(G.style.zIndex=null,G.style.position=null,G.style.pointerEvents=null)},[o]),f.useLayoutEffect(()=>{if(H.current){const G=$.current=br(z);if(L.updateMatrixWorld(),n)z.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const F=d(H.current,R,w);z.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${F[0]}px,${F[1]}px,0);transform-origin:0 0;`}return A&&(l?A.prepend(z):A.appendChild(z)),()=>{A&&A.removeChild(z),G.unmount()}}},[A,n]),f.useLayoutEffect(()=>{O&&(z.className=O)},[O]);const Y=f.useMemo(()=>n?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:a?"translate3d(-50%,-50%,0)":"none",...g&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...r},[r,a,g,w,n]),oe=f.useMemo(()=>({position:"absolute",pointerEvents:x}),[x]);f.useLayoutEffect(()=>{if(B.current=!1,n){var G;(G=$.current)==null||G.render(f.createElement("div",{ref:P,style:Y},f.createElement("div",{ref:S,style:oe},f.createElement("div",{ref:T,className:i,style:r,children:e}))))}else{var F;(F=$.current)==null||F.render(f.createElement("div",{ref:T,style:Y,className:i,children:e}))}});const ie=f.useRef(!0);ye(G=>{if(H.current){R.updateMatrixWorld(),H.current.updateWorldMatrix(!0,!1);const F=n?C.current:d(H.current,R,w);if(n||Math.abs(b.current-R.zoom)>t||Math.abs(C.current[0]-F[0])>t||Math.abs(C.current[1]-F[1])>t){const ee=Kr(H.current,R);let K=!1;N&&(Array.isArray(o)?K=o.map(te=>te.current):o!=="blending"&&(K=[L]));const de=ie.current;if(K){const te=Jr(H.current,R,D,K);ie.current=te&&!ee}else ie.current=!ee;de!==ie.current&&(s?s(!ie.current):z.style.display=ie.current?"block":"none");const we=Math.floor(u[0]/2),zt=o?N?[u[0],we]:[we-1,0]:u;if(z.style.zIndex=`${en(H.current,R,zt)}`,n){const[te,et]=[w.width/2,w.height/2],Se=R.projectionMatrix.elements[5]*et,{isOrthographicCamera:tt,top:Ht,left:Wt,bottom:Bt,right:$t}=R,Nt=tn(R.matrixWorldInverse),Gt=tt?`scale(${Se})translate(${Ue(-($t+Wt)/2)}px,${Ue((Ht+Bt)/2)}px)`:`translateZ(${Se}px)`;let re=H.current.matrixWorld;y&&(re=R.matrixWorldInverse.clone().transpose().copyPosition(re).scale(H.current.scale),re.elements[3]=re.elements[7]=re.elements[11]=0,re.elements[15]=1),z.style.width=w.width+"px",z.style.height=w.height+"px",z.style.perspective=tt?"":`${Se}px`,P.current&&S.current&&(P.current.style.transform=`${Gt}${Nt}translate(${te}px,${et}px)`,S.current.style.transform=rn(re,1/((c||10)/400)))}else{const te=c===void 0?1:Qr(H.current,R)*c;z.style.transform=`translate3d(${F[0]}px,${F[1]}px,0) scale(${te})`}C.current=F,b.current=R.zoom}}if(!N&&j.current&&!B.current)if(n){if(P.current){const F=P.current.children[0];if(F!=null&&F.clientWidth&&F!=null&&F.clientHeight){const{isOrthographicCamera:ee}=R;if(ee||v)_.scale&&(Array.isArray(_.scale)?_.scale instanceof q?j.current.scale.copy(_.scale.clone().divideScalar(1)):j.current.scale.set(1/_.scale[0],1/_.scale[1],1/_.scale[2]):j.current.scale.setScalar(1/_.scale));else{const K=(c||10)/400,de=F.clientWidth*K,we=F.clientHeight*K;j.current.scale.set(de,we,1)}B.current=!0}}}else{const F=z.children[0];if(F!=null&&F.clientWidth&&F!=null&&F.clientHeight){const ee=1/X.factor,K=F.clientWidth*ee,de=F.clientHeight*ee;j.current.scale.set(K,de,1),B.current=!0}j.current.lookAt(G.camera.position)}});const Qe=f.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return f.createElement("group",J({},_,{ref:H}),o&&!N&&f.createElement("mesh",{castShadow:p,receiveShadow:m,ref:j},v||f.createElement("planeGeometry",null),E||f.createElement("shaderMaterial",{side:sr,vertexShader:Qe.vertexShader,fragmentShader:Qe.fragmentShader})))});let ve=0;const Cn=gt(e=>(_e.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-ve)/(i-ve)*100})},_e.onLoad=()=>{e({active:!1})},_e.onError=t=>e(r=>({errors:[...r.errors,t]})),_e.onProgress=(t,r,i)=>{r===i&&(ve=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-ve)/(i-ve)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),He=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Dt(e,t){const r=U(a=>a.gl),i=Q(Xe,He(e)?Object.values(e):e);return f.useLayoutEffect(()=>{t==null||t(i)},[t]),f.useEffect(()=>{if("initTexture"in r){let a=[];Array.isArray(i)?a=i:i instanceof $e?a=[i]:He(i)&&(a=Object.values(i)),a.forEach(g=>{g instanceof $e&&r.initTexture(g)})}},[r,i]),f.useMemo(()=>{if(He(e)){const a={};let g=0;for(const h in e)a[h]=i[g++];return a}else return i},[e,i])}Dt.preload=e=>Q.preload(Xe,e);Dt.clear=e=>Q.clear(Xe,e);const on=()=>parseInt(ar.replace(/\D+/g,"")),Lt=on();function sn(e){return Array.isArray(e)}function We(e=[0,0,0]){return sn(e)?e:e instanceof q||e instanceof ht?[e.x,e.y,e.z]:[e,e,e]}const Sn=f.forwardRef(function({debug:t,depthTest:r=!1,polygonOffsetFactor:i=-10,map:l,mesh:a,children:g,position:h,rotation:c,scale:y,...n},o){const s=f.useRef(null);f.useImperativeHandle(o,()=>s.current);const p=f.useRef(null);return f.useLayoutEffect(()=>{const m=(a==null?void 0:a.current)||s.current.parent,E=s.current;if(!(m instanceof lr))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const v={position:new q,rotation:new ht,scale:new q(1,1,1)};if(m){Z(v,{position:h,scale:y});const u=m.matrixWorld.clone();if(m.matrixWorld.identity(),!c||typeof c=="number"){const d=new cr;d.position.copy(v.position),d.lookAt(m.position),typeof c=="number"&&d.rotateZ(c),Z(v,{rotation:d.rotation})}else Z(v,{rotation:c});return E.geometry=new wr(m,v.position,v.rotation,v.scale),p.current&&(Z(p.current,v),p.current.traverse(d=>d.raycast=()=>null)),m.matrixWorld=u,()=>{E.geometry.dispose()}}},[a,...We(h),...We(y),...We(c)]),f.createElement("mesh",J({ref:s,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":r,"material-map":l},n),g,t&&f.createElement("mesh",{ref:p},f.createElement("boxGeometry",null),f.createElement("meshNormalMaterial",{wireframe:!0}),f.createElement("axesHelper",null)))});let Me=null,Ft="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function It(e,t,r){return i=>{r&&r(i),e&&(Me||(Me=new _r),Me.setDecoderPath(typeof e=="string"?e:Ft),i.setDRACOLoader(Me)),t&&i.setMeshoptDecoder(typeof je=="function"?je():je)}}function Je(e,t=!0,r=!0,i){return Q(Ye,e,It(t,r,i))}Je.preload=(e,t=!0,r=!0,i)=>Q.preload(Ye,e,It(t,r,i));Je.clear=e=>Q.clear(Ye,e);Je.setDecoderPath=e=>{Ft=e};const Rn=f.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:l=!0,keyEvents:a=!1,onChange:g,onStart:h,onEnd:c,...y},n)=>{const o=U(_=>_.invalidate),s=U(_=>_.camera),p=U(_=>_.gl),m=U(_=>_.events),E=U(_=>_.setEvents),v=U(_=>_.set),u=U(_=>_.get),d=U(_=>_.performance),M=t||s,O=i||m.connected||p.domElement,x=f.useMemo(()=>new Er(M),[M]);return ye(()=>{x.enabled&&x.update()},-1),f.useEffect(()=>(a&&x.connect(a===!0?O:a),x.connect(O),()=>void x.dispose()),[a,O,r,x,o]),f.useEffect(()=>{const _=R=>{o(),r&&d.regress(),g&&g(R)},T=R=>{h&&h(R)},k=R=>{c&&c(R)};return x.addEventListener("change",_),x.addEventListener("start",T),x.addEventListener("end",k),()=>{x.removeEventListener("start",T),x.removeEventListener("end",k),x.removeEventListener("change",_)}},[g,h,c,x,o,E]),f.useEffect(()=>{if(e){const _=u().controls;return v({controls:x}),()=>v({controls:_})}},[e,x]),f.createElement("primitive",J({ref:n,object:x,enableDamping:l},y))}),Be=Lt>=154?"opaque_fragment":"output_fragment";class an extends ur{constructor(t){super(t),this.onBeforeCompile=(r,i)=>{const{isWebGL2:l}=i.capabilities;r.fragmentShader=r.fragmentShader.replace(`#include <${Be}>`,`
        ${l?`#include <${Be}>`:`#extension GL_OES_standard_derivatives : enable
#include <${Be}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${Lt>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const On=f.forwardRef((e,t)=>{const[r]=f.useState(()=>new an(null));return f.createElement("primitive",J({},e,{object:r,ref:t,attach:"material"}))}),jn=f.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:l=1,floatingRange:a=[-.1,.1],...g},h)=>{const c=f.useRef(null);f.useImperativeHandle(h,()=>c.current,[]);const y=f.useRef(Math.random()*1e4);return ye(n=>{var o,s;if(!t||r===0)return;const p=y.current+n.clock.getElapsedTime();c.current.rotation.x=Math.cos(p/4*r)/8*i,c.current.rotation.y=Math.sin(p/4*r)/8*i,c.current.rotation.z=Math.sin(p/4*r)/20*i;let m=Math.sin(p/4*r)/10;m=fr.mapLinear(m,-.1,.1,(o=a==null?void 0:a[0])!==null&&o!==void 0?o:-.1,(s=a==null?void 0:a[1])!==null&&s!==void 0?s:.1),c.current.position.y=m*l,c.current.updateMatrix()}),f.createElement("group",g,f.createElement("group",{ref:c,matrixAutoUpdate:!1},e))});let ne,he;const ln=f.createContext(null),pt=new dr,mt=new q,cn=f.forwardRef(({children:e,range:t,limit:r=1e3,...i},l)=>{const a=f.useRef(null);f.useImperativeHandle(l,()=>a.current,[]);const[g,h]=f.useState([]),[[c,y,n]]=f.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);f.useEffect(()=>{a.current.geometry.attributes.position.needsUpdate=!0}),ye(()=>{for(a.current.updateMatrix(),a.current.updateMatrixWorld(),pt.copy(a.current.matrixWorld).invert(),a.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,g.length),ne=0;ne<g.length;ne++)he=g[ne].current,he.getWorldPosition(mt).applyMatrix4(pt),mt.toArray(c,ne*3),a.current.geometry.attributes.position.needsUpdate=!0,he.matrixWorldNeedsUpdate=!0,he.color.toArray(y,ne*3),a.current.geometry.attributes.color.needsUpdate=!0,n.set([he.size],ne),a.current.geometry.attributes.size.needsUpdate=!0});const o=f.useMemo(()=>({getParent:()=>a,subscribe:s=>(h(p=>[...p,s]),()=>h(p=>p.filter(m=>m.current!==s.current)))}),[]);return f.createElement("points",J({userData:{instances:g},matrixAutoUpdate:!1,ref:a,raycast:()=>null},i),f.createElement("bufferGeometry",null,f.createElement("bufferAttribute",{attach:"attributes-position",count:c.length/3,array:c,itemSize:3,usage:ue}),f.createElement("bufferAttribute",{attach:"attributes-color",count:y.length/3,array:y,itemSize:3,usage:ue}),f.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:ue})),f.createElement(ln.Provider,{value:o},e))}),un=f.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:l=3,...a},g)=>{const h=f.useRef(null);return f.useImperativeHandle(g,()=>h.current,[]),ye(()=>{const c=h.current.geometry.attributes;c.position.needsUpdate=!0,r&&(c.color.needsUpdate=!0),i&&(c.size.needsUpdate=!0)}),f.createElement("points",J({ref:h},a),f.createElement("bufferGeometry",null,f.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/l,array:t,itemSize:l,usage:ue}),r&&f.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/l,array:r,itemSize:3,usage:ue}),i&&f.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/l,array:i,itemSize:1,usage:ue})),e)}),Tn=f.forwardRef((e,t)=>e.positions instanceof Float32Array?f.createElement(un,J({},e,{ref:t})):f.createElement(cn,J({},e,{ref:t})));function An({all:e,scene:t,camera:r}){const i=U(({gl:g})=>g),l=U(({camera:g})=>g),a=U(({scene:g})=>g);return f.useLayoutEffect(()=>{const g=[];e&&(t||a).traverse(y=>{y.visible===!1&&(g.push(y),y.visible=!0)}),i.compile(t||a,r||l);const h=new pr(128);new mr(.01,1e5,h).update(i,t||a),h.dispose(),g.forEach(y=>y.visible=!1)},[]),null}export{Mn as C,Sn as D,jn as F,xn as H,Rn as O,An as P,Pn as a,Je as b,Dt as c,ye as d,Tn as e,On as f,En as g,Cn as u};
